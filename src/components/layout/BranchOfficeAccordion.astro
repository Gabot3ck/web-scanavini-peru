---
interface Horario {
  semana: string;
  viernes: string;
  feriados?: string;
}

interface Sucursal {
  id: string;
  nombre: string;
  telefono: string;
  direccion: string;
  horario: Horario;
  gmaps?: string;
}

const sucursales: Sucursal[] = [
  {
    id: 'peru',
    nombre: 'Showroom Perú',
    telefono: '+51 983 487 908',
    direccion: 'Av. Emilio Cavenecia 337, San Isidro, Lima - Perú',
    horario: {
      semana: '08:00 - 18:30',
      viernes: '08:00 - 16:45',
      feriados: 'Cerrado'
    },
    gmaps: 'https://maps.app.goo.gl/KzRQx8N9k7p3zz7J6'
  },
  {
    id: 'matriz-be',
    nombre: 'Casa Matriz Chile',
    telefono: '+56 2 2829 0100',
    direccion: 'Av. Almirante Blanco Encalada 2545, Santiago – Chile.',
    horario: {
      semana: '9:00 - 17:30',
      viernes: '9:00 - 16:15',
      feriados: 'Cerrado'
    },
    gmaps: 'https://maps.app.goo.gl/6NCCv2N3Qnu7GDNd7'
  }
];
---

<div class="flex gap-2 mt-4 max-w-[400px]">
  <div class="w-full space-y-2">
    {sucursales.map((sucursal) => (
      <div class="branch-accordion border border-gray-400 rounded-lg overflow-hidden bg-gray-800/50 hover:bg-gray-800/90 transition-all duration-200">
        <!-- Botón del acordeón -->
        <button
          class="accordion-toggle flex items-center justify-between w-full px-2 py-3 text-left text-background-100 hover:text-white transition-colors duration-150 hover:cursor-pointer focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-opacity-50"
          data-sucursal-id={sucursal.id}
          aria-expanded="false"
          aria-controls={`sucursal-content-${sucursal.id}`}
        >
          <div class="flex items-center gap-3">
            <!-- Icono de tienda -->
            <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
            </svg>
            
            <!-- Título de la sucursal -->
            <div>
              <h4 class="font-semibold text-sm lg:text-base text-gray-200">{sucursal.nombre}</h4>
              <p class="text-xs text-brand-light mt-0.5">Click para ver detalles</p>
            </div>
          </div>

          <!-- Flecha -->
          <svg 
            class="chevron-icon w-5 h-5 transition-transform duration-200 text-gray-500"
            fill="none" 
            stroke="currentColor" 
            viewBox="0 0 24 24"
          >
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
          </svg>
        </button>

        <!-- Contenido expandible -->
        <div 
          class="accordion-content px-4 pb-4 bg-gray-900/50 border-t border-gray-400 max-h-0 overflow-hidden transition-all duration-400 ease-in-out opacity-0"
          id={`sucursal-content-${sucursal.id}`}
        >
          <div class="mt-3 space-y-3">
            <!-- Teléfono -->
            {sucursal.telefono && (
              <div class="flex items-start gap-2">
                <svg class="w-4 h-4 text-brand-light mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                </svg>
                <div>
                  <p class="text-gray-400 text-sm font-medium">Teléfono</p>
                  <a href={`tel:${sucursal.telefono}`} class="text-brand-light hover:text-primary-400 text-sm transition-colors underline">
                    {sucursal.telefono}
                  </a>
                </div>
              </div>
            )}

            <!-- Dirección -->
            <div class="flex items-start gap-2">
              <svg class="w-4 h-4 text-brand-light mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
              </svg>
              <div>
                <p class="text-gray-400 text-sm font-medium">Dirección</p>
                <p class="text-gray-500 text-sm leading-relaxed">{sucursal.direccion}</p>
                {sucursal.gmaps && (
                  <a 
                    href={sucursal.gmaps} 
                    target="_blank" 
                    rel="noopener noreferrer"
                    class="inline-flex items-center gap-1 text-brand-light hover:text-primary-400 text-xs mt-1 transition-colors underline"
                  >
                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                    </svg>
                    Ver en Google Maps
                  </a>
                )}
              </div>
            </div>

            <!-- Horarios -->
            <div class="flex items-start gap-2">
              <svg class="w-4 h-4 text-brand-light mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              <div class="w-full">
                <p class="text-gray-400 text-sm font-medium mb-2">Horarios de Atención</p>
                <div class="space-y-1">
                  <div class="flex justify-between items-center">
                    <span class="text-gray-500 text-xs">Lun - Jue:</span>
                    <span class="text-gray-400 text-xs font-medium">{sucursal.horario.semana}</span>
                  </div>
                  <div class="flex justify-between items-center">
                    <span class="text-gray-500 text-xs">Viernes:</span>
                    <span class="text-gray-400 text-xs font-medium">{sucursal.horario.viernes}</span>
                  </div>
                  {sucursal.horario.feriados && (
                    <div class="flex justify-between items-center">
                      <span class="text-gray-500 text-xs">Sáb, Dom y Feriados:</span>
                      <span class="text-gray-400 text-xs font-medium">{sucursal.horario.feriados}</span>
                    </div>
                  )}
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>
    ))}
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const accordionToggles = document.querySelectorAll('.accordion-toggle');
    
    accordionToggles.forEach(toggle => {
      toggle.addEventListener('click', function(this: HTMLButtonElement) {
        const sucursalId = this.getAttribute('data-sucursal-id');
        const content = document.getElementById(`sucursal-content-${sucursalId}`);
        const chevron = this.querySelector('.chevron-icon');
        const isExpanded = this.getAttribute('aria-expanded') === 'true';
        
        if (!content || !chevron) return;
        
        if (isExpanded) {
          // Cerrar
          content.style.maxHeight = '0px';
          content.style.opacity = '0';
          (chevron as HTMLElement).style.transform = 'rotate(0deg)';
          this.setAttribute('aria-expanded', 'false');
        } else {
          // Cerrar otros acordeones abiertos
          accordionToggles.forEach(otherToggle => {
            if (otherToggle !== this) {
              const otherSucursalId = otherToggle.getAttribute('data-sucursal-id');
              const otherContent = document.getElementById(`sucursal-content-${otherSucursalId}`);
              const otherChevron = otherToggle.querySelector('.chevron-icon');
              
              if (otherContent && otherChevron) {
                otherContent.style.maxHeight = '0px';
                otherContent.style.opacity = '0';
                (otherChevron as HTMLElement).style.transform = 'rotate(0deg)';
                otherToggle.setAttribute('aria-expanded', 'false');
              }
            }
          });
          
          // Abrir el acordeón actual
          content.style.maxHeight = content.scrollHeight + 'px';
          content.style.opacity = '1';
          (chevron as HTMLElement).style.transform = 'rotate(180deg)';
          this.setAttribute('aria-expanded', 'true');
        }
      });
    });
    
    // Manejar navegación por teclado
    accordionToggles.forEach(toggle => {
      toggle.addEventListener('keydown', function(event) {
        if (event.key === 'Enter' || event.key === ' ') {
          event.preventDefault();
          this.click();
        } 
      });
    });
  });
</script>

<style>
  .accordion-content {
    transition: max-height 0.4s ease-in-out, opacity 0.3s ease-in-out;
  }
  
  .chevron-icon {
    transition: transform 0.2s ease-in-out;
  }
  
  /* Mejoras adicionales para accesibilidad */
  .accordion-toggle:focus {
    outline: none;
    ring: 2px;
    ring-color: rgba(250, 100, 40, 0.603);
  }
  
  /* Smooth scroll para contenido largo */
  @media (max-height: 400px) {
    .accordion-content[style*="max-height"][style*="px"] {
      max-height: 200px !important;
      overflow-y: auto;
    }
  }
  
  /* Mejorar hover states */
  .branch-accordion:hover .accordion-toggle {
    background-color: rgba(31, 41, 55, 0.1);
  }
</style>